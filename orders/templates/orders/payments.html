{% extends 'accounts/main.html' %} 
{% load static %}

{% block content %}
 {% include 'accounts/header.html'%}
    <main>
        
        <!--================Checkout Area =================-->
        <section class="checkout_area ">
          <div class="container">
            
            
            <div class="billing_details">
                <h4>Review Your Order And Make Payment</h4>
              <div class="row">
                
                <div class="col-md-7 ftco-animate">
    				<div class="card">
                        <div class="card-header">
                          Billing Address
                        </div>
                        <div class="card-body">
                          <p class="card-text">{{order.full_name}}</p>
                          <p class="card-text">{{order.full_address}}</p>
                          <p class="card-text">{{order.city}},{{order.state}}</p>
                          <p class="card-text">{{order.country}}</p>
                          <p class="card-text">{{order.email}}</p>
                          <p class="card-text">{{order.phone}}</p>
                        </div>
                      </div>
                      <div class="card">
                        <div class="card-header">
                          Payment method
                        </div>
                        <div class="card-body">
                          <p class="card-text">Paypal</p>
                        </div>
                      </div>
             
                    </div>
                    <div class="col col-lg-5 col-md-5 mt-5 cart-wrap ftco-animate">
    				<div class="cart-total mb-3">
    					<h3>Cart Totals</h3>
    					<p class="d-flex">
    						<span>Subtotal</span>
    						<span>$20.60</span>
    					</p>
    					<p class="d-flex">
    						<span>Delivery</span>
    						<span>$0.00</span>
    					</p>
    					<p class="d-flex">
    						<span>Discount</span>
    						<span>$3.00</span>
    					</p>
    					<hr>
    					<p class="d-flex total-price">
    						<span>Total</span>
    						<span>â‚¹{{total}}</span>
    					</p>
    				
                    <div id="paypal-button-container">
                        
                        <!--paypal button will load-->
                    </div>
    			
    		</div>
			</div>
              </div>
            </div>
          </div>
        </section>
        <!--================End Checkout Area =================-->

        
    </main>
    <footer>
        <!-- Footer Start-->
        <div class="footer-area footer-padding">
            <div class="container">
                <div class="row d-flex justify-content-between">
                    <div class="col-xl-3 col-lg-3 col-md-5 col-sm-6">
                        <div class="single-footer-caption mb-50">
                            <div class="single-footer-caption mb-30">
                                <!-- logo -->
                                <div class="footer-logo">
                                    <a href="index.html"><img src="assets/img/logo/logo2_footer.png" alt=""></a>
                                </div>
                                <div class="footer-tittle">
                                    <div class="footer-pera">
                                        <p>Asorem ipsum adipolor sdit amet, consectetur adipisicing elitcf sed do eiusmod tem.</p>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-5">
                        <div class="single-footer-caption mb-50">
                            <div class="footer-tittle">
                                <h4>Quick Links</h4>
                                <ul>
                                    <li><a href="#">About</a></li>
                                    <li><a href="#"> Offers & Discounts</a></li>
                                    <li><a href="#"> Get Coupon</a></li>
                                    <li><a href="#">  Contact Us</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-4 col-sm-7">
                        <div class="single-footer-caption mb-50">
                            <div class="footer-tittle">
                                <h4>New Products</h4>
                                <ul>
                                    <li><a href="#">Woman Cloth</a></li>
                                    <li><a href="#">Fashion Accessories</a></li>
                                    <li><a href="#"> Man Accessories</a></li>
                                    <li><a href="#"> Rubber made Toys</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-5 col-sm-7">
                        <div class="single-footer-caption mb-50">
                            <div class="footer-tittle">
                                <h4>Support</h4>
                                <ul>
                                    <li><a href="#">Frequently Asked Questions</a></li>
                                    <li><a href="#">Terms & Conditions</a></li>
                                    <li><a href="#">Privacy Policy</a></li>
                                    <li><a href="#">Report a Payment Issue</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Footer bottom -->
                <div class="row align-items-center">
                    <div class="col-xl-7 col-lg-8 col-md-7">
                        <div class="footer-copy-right">
                            <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
  Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
  <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>                   
                        </div>
                    </div>
                    <div class="col-xl-5 col-lg-4 col-md-5">
                        <div class="footer-copy-right f-right">
                            <!-- social -->
                            <div class="footer-social">
                                <a href="#"><i class="fab fa-twitter"></i></a>
                                <a href="https://www.facebook.com/sai4ull"><i class="fab fa-facebook-f"></i></a>
                                <a href="#"><i class="fab fa-behance"></i></a>
                                <a href="#"><i class="fas fa-globe"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer End-->
    </footer>
    <!--? Search model Begin -->
    <div class="search-model-box">
        <div class="h-100 d-flex align-items-center justify-content-center">
            <div class="search-close-btn">+</div>
            <form class="search-model-form">
                <input type="text" id="search-input" placeholder="Searching key.....">
            </form>
        </div>
    </div>
    <!-- Search model end -->
<script src="https://www.paypal.com/sdk/js?client-id=Afw6MGOOB8mi70GaJnQrGDwE02Rr4QCuhRJi9MXxZTKrxOSN4mf3jF7pi2qwKUyH5n8RyLFwfS1Gvibe&currency=USD"></script>
<script>
        


    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
  var amount = "{{ total_doller }}"
  var url    = "{% url 'payments' %}"
  var csrftoken = getCookie('csrftoken');
  var orderID  =  "{{order.order_number}}"
  var payment_method = 'Paypal'
  var redirect_url = "{% url 'order_complete' %}"



// Render the PayPal button into #paypal-button-container
paypal.Buttons({

// Set up the transaction
createOrder: function(data, actions) {
    return actions.order.create({
        purchase_units: [{
            amount: {
                value: amount,
            }
        }] 
    });
},

// Finalize the transaction
onApprove: function(data, actions) {
    return actions.order.capture().then(function(details) {
        // Successful capture! For demo purposes:
        // console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
        // var transaction = orderData.purchase_units[0].payments.captures[0];

        console.log(details);
          sendData();
          function sendData(){
              fetch(url, {
                  method : "POST",
                  headers: {
                      "Content-type": "application/json",
                      "X-CSRFToken":  csrftoken,
                  },
                  body: JSON.stringify({
                      orderID : orderID,
                      transID : details.id,
                      payment_method : payment_method,
                      status : details.status,
                  }),
              })
              .then(response => response.json())
              .then(data => {
                  window.location.href = redirect_url + '?order_number=' + data.order_number+'&payment_id='+data.transID;



              });
            }
        
         

        // Replace the above to show a success message within this page, e.g.
        // const element = document.getElementById('paypal-button-container');
        // element.innerHTML = '';
        // element.innerHTML = '<h3>Thank you for your payment!</h3>';
        // Or go to another URL:  actions.redirect('thank_you.html');
    });
}


}).render('#paypal-button-container');
</script>
    

    {% endblock %}